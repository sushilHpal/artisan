# Application Setup Packages

This sections provides packages to setup and build a variety of projects in Kubernetes as follows:

| type | description |
|---|---|
| [quarkus](quarkus) | create a quarkus project and pipeline |
| [spring-boot](spring-boot) | create a spring-boot project and pipeline |


### Configuration variables:

| Variable  | Description  | Example  |
|---|---|---|
|**APP_PACKAGE_NAME**| The name:tag for the application package to be published (e.g. registry-host/app-group/app-name),this package contains application artfacts, dockerfile & build.yaml file. it's used by image builder to build the application img | _registry-host/spring/springboot-app_ |
|**APPLICATION_NAME**| The application name to create openshift tekton pipeline resources eg. EventListner & PipelineResources | _springboot-app_ |
|**ART_RUNNER_URI**| The URI of the Artisan runner to use | _runner_uri_ |
|**CI_NAMESPACE**| The name of the openshift/kubernetes namespace where the app pipeline should be created | _project_ns_ |
|**CRYPTO_KEY_EMAIL**| The email id which is used to generate crypto signature keys by using art cli,this email id is used by img builder to sign the application image | __ |
|**GIT_REPO_EMAIL**| Git user email id to push the spring-boot scaffold code,email id is used to get authenticate with the code repo | __ |
|**GIT_URI**| The URI of the project git repository. create empty git project and pass that uri here. | _https://gitlab.com/group-name/project-name.git_ |
|**HOST_NAME**| openshift or kubernetes cluster hostname required to deploy app & create an ingress | _runner_host_routing |
|**PACKAGE_NAME**| The name:tag for the spring-boot recepie package to download (e.g. registry-host/app-group/package-name),it contains setup & pipeline flow alongwith build.yaml file,this package should be already available in the artefact registry like nexus | _registry-host/spring/springboot_ |
|**PROJECT_ARTIFACT_ID**| The spring-boot artefact id for the application | __ |
|**PROJECT_ARTIFACT_VERSION**| The version of the application artifact | __ |
|**PROJECT_GROUP_ID**|  The spring-boot group id for the project | __ |
|**PULL_IMAGE_REGISTRY**| application runtime image registry name (eg. registry.gitlab.com),this is the name of the image registry where base docker image is stored. it can be redhat, gitlab or quay registry | _registry.redhat.io_ |
|**PUSH_IMAGE_NAME**| The application image name. it's a final image name that will be pushed into the img registry,we can pass any name (eg. java-app) | __ |
|**PUSH_IMAGE_REGISTRY**| The image registry name (eg. registry.gitlab.com),it's use to push application image into the image registry | _registry.gitlab.com_ |
|**PUSH_IMAGE_REPO**| the image repo name,repo name of the image registry where image to be pushed. if repo is created under user then it will be username,if it's created inside the specific group then it would be a group name | _gitlab_username_ |
|**PUSH_IMAGE_VERSION**| the application image version/tag. it's a docker image tag used to identify the img uniquely | __ |
|**SETUP_NAMESPACE**| the name of the openshift/kubernetes namespace where the setup pipeline should be created | _project_ns_ |
|**SONAR_BINARIES**| the path the sonar scanner should use to scan binary files | _build/classes_ |
|**SONAR_PROJECT_KEY**| the unique key identifying the project in the SonarQube server | _net.atos:springboot-app_ |
|**SONAR_SOURCES**| the path the sonar scanner should use to scan source code | _src/_ |
|**SONAR_URI**| the URI of the SonarQube server to use for code quality reporting | __ |
|**ART_REG_PWD**| the password to authenticate with the Artisan Registry (used by Application publish-app function) The container is only allowed to go up to the limit, and then it is restricted | __ |
|**ART_REG_USER**|  the user to authenticate with the Artisan Registry (used by Application publish-app function) | __ |
|**ART_RUNNER_PWD**| the password to authenticate with the Artisan Runner | __ |
|**ART_RUNNER_UNAME**| the user to authenticate with the Artisan Runner | __ |
|**GIT_REPO_PWD**| it's used to push the code generated by the spring-boot scaffold | __ |
|**GIT_REPO_UNAME**| git repo user name to push the code,it's used to push the code generated by the spring-boot scaffold | __ |
|**PULL_IMAGE_REGISTRY_PWD**| password for the container registry where the base image is located | _redhat_pwd_ |
|**PULL_IMAGE_REGISTRY_UNAME**| user name for the container registry where the base image is located | _redhat_uname_ |
|**PUSH_IMAGE_REGISTRY_PWD**|  password for the container registry where the application image will be pushed | _gitlab_pwd_ |
|**PUSH_IMAGE_REGISTRY_UNAME**| user name for the container registry where the application image will be pushed | _gitlab_uname_ |
|**REGISTRY_PWD**| artefact registry password where artefact will be pushed | __ |
|**REGISTRY_USER**| artefact registry user name where artefact will be pushed | __ |
|**SONAR_TOKEN**| the token to access the sonar server,open sonar dashboard -> click on My Account -> Security -> Genearte new token | __ |
|**SPRINGBOOT_SETUP_CREATE_PROJECT_OXART_REG_PWD**| password for the container registry to download the recipe package,this variable is required when we use art exec command to setup pipeline | _registry_pwd_ |
|**SPRINGBOOT_SETUP_CREATE_PROJECT_OXART_REG_USER**| user name for the container registry to download the recipe package,this variable is required when we use art exec command to setup pipeline | _registry_uname_ |
|**SPRING_SPRINGBOOT_OXART_REG_USER**| the username to authenticate with the registry at aps-edge-registry.amosonline.io' | _registry_uname_ |
|**SPRING_SPRINGBOOT_OXART_REG_PWD**| the password to authenticate with the registry at 'aps-edge-registry.amosonline.io' | _registry_pwd_ |
|**SIGNING_KEY**| the path of the key in the artisan registry as follow the private PGP key required to digitally sign the application package | _/_ |
|**SPRINGBOOT_SETUP_CREATE_PROJECT_OXART_VERIFICATION_KEY**| the path of the key in the artisan registry as follow the public PGP key required to open the recipe package,this variable is required when we use art exec command to setup pipeline | _/_ |
|**VERIFICATION_KEY**| the path of the key in the artisan registry as follow the public PGP key required to open the application package | _/_ |
|**SPRING_SPRINGBOOT_OXART_VERIFICATION_KEY**| the path of the key in the artisan registry as follow the public PGP key required to open the package aps-edge-registry.amosonline.io | _/_ |

# How to build the packages

Use the below commands to create artisan packages. Please refer build.yaml file for available profiles.

```bash
# build package using art cli
art build -t <PACKAGE_NAME> -p <ART_PROFILE>

# push package into the repository
art push -u=<ART_REG_USER>:<ART_REG_PWD> <PACKAGE_NAME>
```

# How to run the packages

If the package is already available in the repository then use the below commands to use them

```bash
# Pull package from repository
art pull -u=<ART_REG_USER>:<ART_REG_PWD> <PACKAGE_NAME>

# Generate configuration file & populate configuration
art env package <PACKAGE_NAME>

# Update corresponding environment variable values
vi .env

# Execute package
art exec -u=<ART_REG_USER>:<ART_REG_PWD> <PACKAGE_NAME> setup

```

